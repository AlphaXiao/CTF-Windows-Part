# 子网划分与远程桌面服务
## 1. 子网掩码
- 255 是网络位， 0是主机位
- 网络位相同说明处于同一网段
例:
192.168.1.2
192.168.2.3
192.168.4.5
172.16.1.2
172.16.8.8

> 以上所有ip的子网掩码都是 `255.255.0.0`,说明前三个在同一个网段，后两个在同一个网段，因为网络位相同。根据子网掩码可得出，前三个的ip所属网段地址为 `192.168.0.0`,后两个ip所属网段地址为 `172.16.0.0`


192.168.1.0/24  表示该地址的网络位占24个二进制

等于给

192.168.1.0配置了255.255.255.0作为子网掩码

 
## 2. 一个网段下的可配置IP地址

+ 假设网段为10.1.1.0/24

10.1.1.0  网段地址

10.1.1.255  广播地址

10.1.1.1/24 ~ 10.1.1.254/24  可用IP范围

可用IP数量：2的8次方  -  2个不可用地址  254


- 假设网段为10.1.0.0/16

10.1.0.0  网段地址

10.1.**255.255**  广播地址

10.1.0.1/16 ~ 10.1.255.254/16  可用IP范围

可用IP数量：2的16次方 -2    65534 


一个网段中的可用IP地址数量

$2^n-2$ (n表示主机位的位数)


## 3. 国际组织ISO对IP地址的规定

 ISO组织将IP地址分为了5大类

A类：首段为1 ~ 126的IP地址

   默认子网掩码255.0.0.0

B类：首段为128 ~ 191的IP地址

   默认子网掩码255.255.0.0

C类：首段为192 ~ 223的IP地址

   默认子网掩码255.255.255.0

D类：224 ~ 239  组播地址

E类：240 ~ 254  科研地址

首段为255的地址用作掩码

首段为127的地址作为回环地址

 

## 4. 私有IP

为了解决IP地址不够用的问题，将IP地址分为公网IP和私有IP

公网IP（在全世界只能出现一次的IP）

私有IP 私有IP不能出现在互联网上，只能在局域网中使用。私有IP在不同的局域网中可以重复使用

10.0.0.0/8 ~ 10.255.255.255/8

172.16.0.0/16 ~ 172.31.255.255/16

192.168.0.0/16 ~ 192.168.255.255/16 

> **注意比如192.168.5.3/24其实是属于192.168.0.0的延伸，所以也是属于私有ip的**



## 5. 子网划分

- 满足不同网络对IP地址的需求

- 实现网络的层次性（有层次的子网划分，可以极大地提高国际带宽）

- 节省IP地址

比如：

20.0.0.0/8  中国  

20.0.0.0/16  上海

20.1.0.0/16  北京

20.1.0.0/24 朝阳区 

朝阳1社区

朝阳2社区

20.1.1.0/24 海淀区

20.1.2.0/24 昌平区

20.2.0.0/16  天津

20.3.0.0/16  石家庄

 

## 6. VLSM 可变长子网掩码	

除了标准子网掩码之外，也可以使用/15、/27、/30等非8的整数倍的位数作为网络位

![img](https://github.com/AlphaXiao/CTF-Windows-Security/blob/main/Days/pictures/%E5%9B%BE%E7%89%87164.png) 

 

> 某公司共有技术部、生产部、财务部、销售部，4个部门，每个部门不超过50台计算机。若该公司拥有一个C类地址192.168.100.0/24。要求不同的部门处于不同的局域网中，该如何划分子网？
- 如果借一位，就是两个subnet，题目要求4个部门在不同的局域网，所以只能借2位，这样就有4个subnet

  （1）192.168.100.0/26     

  （2）192.168.100.64/26
 
  （3）192.168.100.128/26

  （4）192.168.100.192/26

掩码 255.255.255.192


> 若公司共有5个部门，每个部门不超过30台计算机，公司拥有的地址为192.168.100.0/24，每个部门有用自己的局域网，该如何划分？

192.168.100.0/27   

192.168.100.32/27            

192.168.100.64/27   

192.168.100.96/27  

192.168.100.128/27  

192.168.100.160/27

192.168.100.192/27

192.168.100.224/27



> 若该公司共5个部门和一组服务器，其中，技术部、生产部各有主机50台，财务部、销售部、客服部各有主机20台，服务器共6台主机。公司拥护地址192.168.100.0/24，该如何划分子网。

  （1）192.168.100.0/26     技术部 

  （2）192.168.100.64/26    生产部
  
  > 注意：这里只是把192.168.100.128/26给进一步分成了四份

  （3）192.168.100.128/27     财务部 

  （4）192.168.100.160/27     销售部  

  （5）192.168.100.192/27     客服部

  （6）192.168.100.224/27     服务器组

 

## 7. 局域网通信

> **注意: 桥接模式表示和主机连入同一局域网，和主机各占一个ip**

将多台虚拟机放置在同一个局域网中（多个虚拟机处于同一个vmnet，就表示处于同一个局域网）

![img](https://github.com/AlphaXiao/CTF-Windows-Security/blob/main/Days/pictures/%E5%9B%BE%E7%89%87165.png) 

- 配置ip地址：
右键网上邻居→属性→右键本地连接→属性→Internet协议（TCP/IP）

将每台虚拟机的IP地址配置完毕后，可以使用ping命令测试彼此之间的联通性

可正常通信的ping执行结果

![img](https://github.com/AlphaXiao/CTF-Windows-Security/blob/main/Days/pictures/%E5%9B%BE%E7%89%87166.png) 

无法通信的ping执行结果

![img](https://github.com/AlphaXiao/CTF-Windows-Security/blob/main/Days/pictures/%E5%9B%BE%E7%89%87167.png) 

- 练习：判断是否在同一网段
 
100.10.4.3/15    100.11.5.3/15  
> 前八位的十进制都是100相同，看9-16位，10的二进制是`00001010`，11的二进制是`00001011`，`/15`说明有7位是网络位，两个数字的前七位都是`0000101` 所以他们**在同一网段**

192.168.1.1/16    192.168.1.2/24
> 注意：现实通讯中，机子互ping并不能知道相互的子网掩码，所以判断是不是同一个网段是通过本机ip去与目标ip匹配。比如这道题，`192.168.1.1`的子网掩码是 `255.255.0.0`所属网段为`192.168.0.0`,当知道目标地址是 `192.168.1.2`时，并不知道目标地址的子网掩码是 `255.255.255.0`,所属网段是`192.168.1.0`, 只是用自己的网段去和目标地址的ip进行对比，发现 `192.168`与`192.168`匹配，默认**在同一网段**可以通讯。当目标地址要和源地址通讯是也是一样，用自己的网段和源地址ip匹配发现`192.168.1`和`192.168.1`一样，默认**同一网段**可以通讯。 
 
192.168.1.1/16    192.168.2.2/24
> 注意：`192.168.1.1`的子网掩码是 `255.255.0.0`所属网段为`192.168.0.0`,当知道目标地址是 `192.168.1.2`时，并不知道目标地址的子网掩码是 `255.255.255.0`,所属网段是`192.168.1.0`, 只是用自己的网段去和目标地址的ip进行对比，发现 `192.168`与`192.168`匹配，默认**在同一网段**可以通讯。当目标地址要和源地址通讯，用自己的网段和源地址ip匹配发现`192.168.2`和`192.168.1`不一样，**在不同网段**无法通讯。 这就可能会出现`request timed out`的情况。

## 8. 计算机在通信时的心里活动

当一台PC想要访问某个IP时，先用自己的子网掩码对照目标IP是否与自己的IP处于同一个网段，如果处于同一个网段，则发送信息到目标IP。如果不是同一个网段则发送信息到网关（网关是边界处连接局域网和互联网的地方），等待网关的转发。

当一台PC接受到某个信息时，首先查看源IP地址，并用自己的子网掩码对照源IP是否与自己的IP处于同一个网段，如果处于同一个网段，则以源IP为目标发送信息，否则发送至网关。

## 9. 远程管理

远程桌面服务（端口号：`3389`）

在CMD中通过`netstat -an`可查看当前计算机开放的端口编号。如果在命令结果中可看到`3389`端口，则说明该计算机开启了远程桌面服务

## 2003开启远程桌面服务

1. 确保设备之间可正常通信

2. 右击2003的“我的电脑”，选择“属性”

![img](https://github.com/AlphaXiao/CTF-Windows-Security/blob/main/Days/pictures/%E5%9B%BE%E7%89%87168.png) 

3. 在界面的“远程”选项中勾选“启用这台计算机上的远程桌面”

![img](https://github.com/AlphaXiao/CTF-Windows-Security/blob/main/Days/pictures/%E5%9B%BE%E7%89%87169.png) 

4. 在xP机上打开远程桌面访问工具

![img](https://github.com/AlphaXiao/CTF-Windows-Security/blob/main/Days/pictures/%E5%9B%BE%E7%89%87170.png) 

（或者使用“运行”输入命令mstsc，也可打开远程桌面访问工具）

5. 在访问工具上输入2003机器的IP地址，并点击连接

![img](https://github.com/AlphaXiao/CTF-Windows-Security/blob/main/Days/pictures/%E5%9B%BE%E7%89%87171.png) 

6. 之后输入2003计算中的账号密码

![img](https://github.com/AlphaXiao/CTF-Windows-Security/blob/main/Days/pictures/%E5%9B%BE%E7%89%87172.png) 

7. 如果账号密码正确则成功访问远程桌面

![img](https://github.com/AlphaXiao/CTF-Windows-Security/blob/main/Days/pictures/%E5%9B%BE%E7%89%87173.png) 
